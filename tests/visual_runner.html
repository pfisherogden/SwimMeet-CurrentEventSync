<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Visual UX Feature Tests</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            height: 100vh;
            margin: 0;
        }

        .controls {
            width: 300px;
            padding: 20px;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-right: 1px solid #ccc;
        }

        .preview {
            flex: 1;
            position: relative;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        button {
            padding: 10px;
            cursor: pointer;
            font-size: 1rem;
        }

        .status {
            margin-top: 20px;
            font-weight: bold;
        }

        .pass {
            color: green;
        }

        .fail {
            color: red;
        }
    </style>
</head>

<body>
    <div class="controls">
        <h2>UX Verifier</h2>
        <p>Loads main app via iframe with Mock Data.</p>

        <button onclick="runDarkModeTest()">Test 1: Dark Mode</button>
        <button onclick="runHeartbeatTest()">Test 2: Heartbeat/Flash</button>
        <button onclick="runFullDemo()">Run All & Reset</button>

        <div id="status" class="status">Ready</div>
        <div id="log"></div>
    </div>
    <div class="preview">
        <!-- Load app in offline + test mode -->
        <iframe id="appFrame" src="../docs/index.html?offline=true&test=true&meetName=Test%20Meet"></iframe>
    </div>

    <script>
        const frame = document.getElementById('appFrame');
        const statusEl = document.getElementById('status');

        function log(msg) {
            const div = document.createElement('div');
            div.textContent = msg;
            document.getElementById('log').appendChild(div);
        }

        function getApp() {
            return frame.contentWindow.swimApp;
        }

        async function wait(ms) {
            return new Promise(r => setTimeout(r, ms));
        }

        async function runDarkModeTest() {
            statusEl.textContent = "Running Dark Mode Test...";
            const app = getApp();
            if (!app) {
                statusEl.textContent = "Error: App not ready (swimApp missing)";
                return;
            }

            // check initial state (should be light/false, or whatever persistence says)
            // Force reset to light first if needed? We'll just toggle.
            const docBody = frame.contentDocument.body;
            const wasDark = docBody.classList.contains('dark-mode');

            app.toggleTheme();
            await wait(500); // wait for transition

            const isDark = docBody.classList.contains('dark-mode');
            if (isDark !== !wasDark) {
                statusEl.textContent = "FAIL: Theme did not toggle";
                statusEl.className = "fail";
            } else {
                statusEl.textContent = "PASS: Dark Mode Toggled";
                statusEl.className = "pass";
            }
        }

        async function runHeartbeatTest() {
            statusEl.textContent = "Running Heartbeat Test...";
            const app = getApp();

            // Trigger update
            app.updateDisplay("Event 100", "Heat 5", "Now");

            // Check for flash class immediately
            const eventElParent = app.element.event.parentElement;

            // Give it a small tick for class to apply if async, but it should be sync in updateDisplay
            // The animation class is .flash-update
            if (eventElParent.classList.contains('flash-update')) {
                statusEl.textContent = "PASS: Flash animation triggered";
                statusEl.className = "pass";
            } else {
                statusEl.textContent = "FAIL: No flash class found";
                statusEl.className = "fail";
            }

            await wait(1000); // Let animation play
        }

        async function runFullDemo() {
            const app = getApp();
            // Reset
            app.updateDisplay("--", "--", "");
            await wait(1000);

            await runDarkModeTest();
            await wait(1000);
            await runDarkModeTest(); // Toggle back
            await wait(1000);
            await runHeartbeatTest();
        }
    </script>
</body>

</html>